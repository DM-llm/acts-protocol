# ACTS 协议

> **Agent Context Tree Standard**  
> A feature-first context protocol for AI Agents  
> 版本：1.0

---

## 什么是 ACTS？

ACTS（Agent Context Tree Standard）是一个以功能为中心的 AI Agent 上下文管理标准，帮助 AI 助手理解项目结构、遵循团队规范、维护长期知识。

**核心理念**：
- 🌳 **Tree Structure**：功能内聚的树状组织
- 🎯 **Feature-First**：按功能而非时间组织文档
- 🧠 **Long-term Memory**：结构化的知识积累
- 🤖 **Agent-Friendly**：为 AI Agent 优化的协议

**核心价值**：
- 🎯 AI 生成符合团队规范的代码
- 📚 长期知识积累（经验教训、工作日志）
- 🔄 任务间无缝切换上下文
- 🤝 团队协作与共享规范

---

## 快速开始

当你看到这个文件时，应该：

1. **读取 `context/current-task.md`** 了解当前工作内容
2. **搜索 `context/docs/INDEX.md`** 查找相关文档
3. **检查 `context/docs/lessons/`** 避免重复踩坑（全局经验教训）
4. **查看功能的 `work-logs/`** 了解历史实现
5. **遵循下面的执行流程**

---

## 核心原则

### 1. 架构优先

- 写代码前先考虑整体架构，不要只解决眼前问题
- 评估对现有模块的影响，避免引入不必要的耦合
- 遵循项目已有的设计模式和代码风格
- 考虑可扩展性：这个方案能否适应未来需求变化？
- 考虑可维护性：其他人能否轻松理解和修改？

### 2. 解释为主

写代码时必须解释：
- **为什么**这样写（架构考虑）
- **替代方案**及其优劣（权衡）
- **潜在问题**需要注意（边界情况、性能）

### 3. 搜索优先

执行任务前必须搜索：
- 检查 `context/docs/` 中的架构决策
- 检查 `context/docs/lessons/` 中的历史教训
- 检查功能的 `work-logs/` 中的实现历史

---

## 执行流程

### 第 1 步：恢复任务上下文
```
读取 context/current-task.md → 了解当前关注点
```

### 第 2 步：搜索相关资料（必须）
```
查询 context/docs/INDEX.md → 定位到分类（前端/后端/AI层）
  ↓
查询对应分类的 INDEX.md → 找到具体功能
  ↓
进入功能文件夹 → 查看 work-logs/ 子目录（历史实现）
  ↓
搜索 context/docs/lessons/ → 查找全局经验（最近的优先级更高）
  ↓
如果找到相关资料，先读取再执行任务
```

### 第 3 步：识别任务类型

- **路径匹配**：
  - `*/web/*` → 前端任务
  - `*/backend/*` 或 `*/api/*` → 后端任务
  - `*/ai/*` 或 `*/ml/*` → AI 层任务

- **关键词匹配**：
  - "前端"、"React"、"组件" → 前端
  - "后端"、"API"、"数据库" → 后端
  - "review doc"、"rd" → PR 文档
  - "调试"、"报错"、"修复" → 调试

### 第 4 步：加载对应规则
```
查询 context/docs/INDEX.md
  ↓
找到模块入口文档
  ↓
按需加载详细文档
```

### 第 5 步：智能推荐 lessons

- 搜索 `context/docs/lessons/` 中所有相关经验
- 最近的 lessons 优先级更高（技术栈会变化）
- 旧的 lessons 同样重要（长期洞察）
- 综合考虑时间和相关性

---

## 文档组织

### 任务中心
- **位置**：`context/current-task.md`
- **用途**：只追踪 1-3 个当前任务
- **更新**：开始/完成任务时更新

### 技术文档（按功能聚合）
- **位置**：`context/docs/`
- **结构**：按模块 → 功能组织
- **索引**：`context/docs/INDEX.md`（总是先查这里）
- **用途**：架构设计、API 文档、设计决策

**示例结构**：
```
context/docs/
├── INDEX.md
├── lessons/                     # 全局经验教训
├── 前端/
│   ├── INDEX.md
│   ├── 用户认证/
│   │   ├── 01-架构设计.md
│   │   └── work-logs/           # 这个功能的工作日志
│   │       └── 2026-01-26-登录流程优化.md
│   └── 数据展示/
│       ├── 01-表格组件.md
│       └── work-logs/
├── 后端/
└── 全栈/                        # 跨模块的内容
    ├── INDEX.md
    ├── API集成/                # 跨模块功能
    │   ├── 01-接口设计.md
    │   └── work-logs/
    │       └── 2026-01-29-第三方API对接.md
    └── 数据流转/
        ├── 01-完整链路.md
        └── work-logs/
```

### 工作日志（功能内聚）
- **位置**：`context/docs/{模块}/{功能}/work-logs/`
- **命名**：`YYYY-MM-DD-{TYPE}-{DESCRIPTION}.md`
- **用途**：完整的实现记录
- **保留**：永久保留（绝不删除）
- **原则**：工作日志和功能文档放在一起，方便查找和沉淀

#### Work Log 类型标准

| 类型 | 用途 | AI 思维模式 | 示例 |
|------|------|-------------|------|
| **`impl`** | 新功能开发或改进 | 🌟 发散思维（探索） | `impl-user-login` |
| **`fix`** | Bug 修复和错误修正 | 🎯 收敛思维（调试） | `fix-token-timeout` |
| **`pr`** | PR 评审反馈和修改 | 🤝 对齐思维（遵守） | `pr-review-security` |
| **`refactor`** | 代码重构（功能不变） | ♻️ 优化思维（改进） | `refactor-split-service` |

**为什么需要类型？**
- `fix` 是最宝贵的反面教材 — AI 必须仔细读，避免重复错误
- `pr` 是团队强制规范 — AI 必须严格遵守这些规则
- `impl` 是设计意图 — AI 理解功能为什么这样设计
- `refactor` 是优化历史 — AI 知道代码变了但功能没变

**跨模块的工作日志**：
- **位置**：`context/docs/全栈/{功能}/work-logs/`
- **用途**：涉及多个模块的任务记录

### 经验教训（全局共享）
- **位置**：`context/docs/lessons/`
- **命名**：`YYYY-MM-DD-{DESCRIPTION}.md`
- **用途**：需要避免的错误、反直觉的洞察
- **保留**：永久保留（绝不删除）
- **特点**：跨模块复用，全局可见

### PR 文档（特殊的 Work Log）
- **位置**：`context/docs/{模块}/{功能}/work-logs/`
- **命名**：`YYYY-MM-DD-pr-{DESCRIPTION}.md`
- **用途**：记录 Code Review 反馈和修正过程
- **本质**：PR 文档是功能演进的关键节点，应该和功能文档放在一起

**为什么不单独建 `reviews/` 目录？**
- ❌ 违背 Feature-first 原则（按流程而非功能归档）
- ❌ PR 反馈和功能割裂，AI 维护功能时看不到历史教训
- ✅ 功能内聚：完整的演进故事（开发 → PR 反馈 → 修正 → 上线）

---

## 记录规则

### ✅ 何时记录

#### 工作日志（自动）
- 任务完成 → 记录到 `docs/{模块}/{功能}/work-logs/YYYY-MM-DD-{TYPE}-{DESCRIPTION}.md`
- 包含：背景、方案、实现、遇到的问题
- **功能内聚**：工作日志和功能文档放在一起
- **跨模块任务**：记录到 `docs/全栈/{功能}/work-logs/`

**命名类型**：
- `impl` - 新功能开发或改进
- `fix` - Bug 修复（最重要的反面教材）
- `pr` - PR 评审反馈（团队强制规范）
- `refactor` - 代码重构（功能不变）

#### 经验教训（仅用户触发）🚫
**关键规则**：绝不自动创建 lessons。只有以下情况：

1. **用户明确指令**：
   - "把这个记下来"
   - "这是一个坑"
   - "保存为 lesson"

2. **高风险询问**（可选）：
   - 如果发现极度反直觉的解决方案
   - 或修正了严重的架构缺陷
   - 询问："这个问题很典型，是否需要我将其整理为 lesson？"
   - 只有得到"是"的回复后才写入

**你的角色**：秘书（执行），不是决策者（判断价值）

**Lesson 判断标准**：
- ✅ 有明确的"错误认知" → "正确认知"
- ✅ 可以用一句话总结教训
- ✅ 未来遇到类似问题能直接查阅
- ✅ 跨模块复用的经验
- ❌ 详细的调试过程 → 应该在功能的 work-logs
- ❌ 测试结果记录 → 应该在功能的 work-logs
- ❌ 功能实现细节 → 应该在 docs 的功能文档

#### 功能文档（按需）
- 重要架构 → `docs/{模块}/{功能}/{序号}-{主题}.md`
- 更新索引 → `docs/INDEX.md`

---

## 规则优先级

1. **用户明确指令**（最高优先级）
2. **任务相关的 lessons**（经验教训）
3. **模块规则**（`context/steering/`）
4. **项目规则**（本文件）

---

## 上下文优化

### 懒加载
- 只加载相关文档
- 避免加载无关内容
- 使用文件引用而非完整内容

### 避免重复
- 同一对话中不重复加载规则
- 使用指针：`#[[file:path/to/doc.md]]`

### 永久保留
- 功能文件夹中的 `work-logs/` 是永久知识
- `docs/lessons/` 是全局经验教训
- 绝不删除或归档
- 它们积累团队智慧

**为什么功能内聚？**
- 查看某个功能时，所有相关内容都在一起
- 从 work-logs 沉淀到功能文档更自然
- 不用在多个目录间跳转

---

## 项目特定配置

检查 `context/steering/` 中的项目特定规则：
- `project.md` - 项目概述、技术栈
- `debugging.md` - 服务启动、调试指南
- `language.md` - 语言偏好
- `pr-docs.md` - PR 文档规范

---

## 获取帮助

- **文档**：查看 ACTS 仓库中的 `docs/` 文件夹
- **示例**：查看 `examples/` 中的示例项目
- **问题**：在 GitHub 上报告问题

---

## 版本历史

- **1.0**（2026-01-31）：初始版本

---

## 许可证

本协议开源。详见 LICENSE 文件。
